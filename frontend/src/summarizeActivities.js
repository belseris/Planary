/**
 * src/summarizeActivities.js
 * Activity Summary Generator
 * 
 * à¸Ÿà¸µà¹€à¸ˆà¸­à¸£à¹Œ: à¸ªà¸£à¹‰à¸²à¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸ªà¸£à¸¸à¸›à¸à¸´à¸ˆà¸à¸£à¸£à¸¡à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´à¸ªà¸³à¸«à¸£à¸±à¸š diary
 * 
 * Use Case:
 * - à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸ªà¸£à¹‰à¸²à¸‡ diary à¹ƒà¸«à¸¡à¹ˆ
 * - à¸£à¸°à¸šà¸šà¸”à¸¶à¸‡à¸à¸´à¸ˆà¸à¸£à¸£à¸¡à¸‚à¸­à¸‡à¸§à¸±à¸™à¸™à¸±à¹‰à¸™à¸¡à¸²à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”
 * - à¸ªà¸£à¹‰à¸²à¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸ªà¸£à¸¸à¸›à¹€à¸•à¸´à¸¡à¹ƒà¸™ detail field à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´
 * 
 * à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡ Output:
 * ```
 * à¸ªà¸£à¸¸à¸›à¸à¸´à¸ˆà¸à¸£à¸£à¸¡à¹ƒà¸™à¸§à¸±à¸™à¸™à¸µà¹‰:
 * 
 * âœ… 08:00 - à¸­à¸­à¸à¸à¸³à¸¥à¸±à¸‡à¸à¸²à¸¢ (à¹€à¸ªà¸£à¹‡à¸ˆà¹à¸¥à¹‰à¸§)
 * ğŸŸ§ 10:00 - à¸—à¸³à¸‡à¸²à¸™ Project A (à¸à¸³à¸¥à¸±à¸‡à¸—à¸³)
 * â¬œï¸ 14:00 - à¸›à¸£à¸°à¸Šà¸¸à¸¡à¸—à¸µà¸¡ (à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¹€à¸£à¸´à¹ˆà¸¡)
 * 
 * à¸„à¸§à¸²à¸¡à¸£à¸¹à¹‰à¸ªà¸¶à¸à¸§à¸±à¸™à¸™à¸µà¹‰: 
 * ```
 */

/**
 * generateActivitySummary - à¸ªà¸£à¹‰à¸²à¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸ªà¸£à¸¸à¸›à¸à¸´à¸ˆà¸à¸£à¸£à¸¡
 * 
 * @param {Array} activities - à¸£à¸²à¸¢à¸à¸²à¸£à¸à¸´à¸ˆà¸à¸£à¸£à¸¡à¸‚à¸­à¸‡à¸§à¸±à¸™à¸™à¸±à¹‰à¸™
 * @returns {string} à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸ªà¸£à¸¸à¸›à¸—à¸µà¹ˆ formatted à¸à¸£à¹‰à¸­à¸¡ emoji
 * 
 * Features:
 * - à¹€à¸£à¸µà¸¢à¸‡à¸•à¸²à¸¡à¹€à¸§à¸¥à¸² (à¸à¸´à¸ˆà¸à¸£à¸£à¸¡ "à¸—à¸±à¹‰à¸‡à¸§à¸±à¸™" à¸­à¸¢à¸¹à¹ˆà¸—à¹‰à¸²à¸¢à¸ªà¸¸à¸”)
 * - à¹à¸ªà¸”à¸‡ status à¹€à¸›à¹‡à¸™ emoji (âœ… à¹€à¸ªà¸£à¹‡à¸ˆ, ğŸŸ§ à¸à¸³à¸¥à¸±à¸‡à¸—à¸³, â¬œï¸ à¸£à¸­)
 * - Format: [emoji] [time] - [title] (status)
 */
export function generateActivitySummary(activities) {
  // à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸¡à¸µà¸à¸´à¸ˆà¸à¸£à¸£à¸¡
  if (!activities || activities.length === 0) {
    return 'à¹„à¸¡à¹ˆà¸¡à¸µà¸à¸´à¸ˆà¸à¸£à¸£à¸¡à¹ƒà¸™à¸§à¸±à¸™à¸™à¸µà¹‰';
  }

  // à¸ˆà¸±à¸”à¹€à¸£à¸µà¸¢à¸‡à¸•à¸²à¸¡à¹€à¸§à¸¥à¸² (à¸à¸´à¸ˆà¸à¸£à¸£à¸¡ "à¸—à¸±à¹‰à¸‡à¸§à¸±à¸™" à¸­à¸¢à¸¹à¹ˆà¸—à¹‰à¸²à¸¢à¸ªà¸¸à¸”)
  const sorted = [...activities].sort((a, b) => {
    if (!a.time) return 1;
    if (!b.time) return -1;
    return a.time.localeCompare(b.time);
  });

  // à¹à¸¢à¸à¸à¸´à¸ˆà¸à¸£à¸£à¸¡à¸•à¸²à¸¡ status
  const done = sorted.filter(a => a.status === 'done');
  const inProgress = sorted.filter(a => a.status === 'urgent');
  const pending = sorted.filter(a => a.status === 'normal');
  const cancelled = sorted.filter(a => a.status === 'cancelled');

  // à¸ªà¸£à¹‰à¸²à¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸ªà¸£à¸¸à¸›à¹à¸šà¸šà¹€à¸£à¸µà¸¢à¸šà¸‡à¹ˆà¸²à¸¢
  let summary = 'à¸ªà¸£à¸¸à¸›à¸à¸´à¸ˆà¸à¸£à¸£à¸¡à¸›à¸£à¸°à¸ˆà¸³à¸§à¸±à¸™\n';
  summary += 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n';

  // à¸à¸´à¸ˆà¸à¸£à¸£à¸¡à¸—à¸µà¹ˆà¸—à¸³à¹€à¸ªà¸£à¹‡à¸ˆ
  if (done.length > 0) {
    summary += 'à¸—à¸³à¹€à¸ªà¸£à¹‡à¸ˆà¹à¸¥à¹‰à¸§:\n';
    done.forEach((act) => {
      const timeStr = act.time ? act.time.slice(0, 5) : 'à¸—à¸±à¹‰à¸‡à¸§à¸±à¸™';
      summary += `â€¢ ${act.title} (${timeStr})\n`;
    });
    summary += '\n';
  }

  // à¸à¸´à¸ˆà¸à¸£à¸£à¸¡à¸—à¸µà¹ˆà¸à¸³à¸¥à¸±à¸‡à¸—à¸³
  if (inProgress.length > 0) {
    summary += 'à¸à¸³à¸¥à¸±à¸‡à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£:\n';
    inProgress.forEach((act) => {
      const timeStr = act.time ? act.time.slice(0, 5) : 'à¸—à¸±à¹‰à¸‡à¸§à¸±à¸™';
      summary += `â€¢ ${act.title} (${timeStr})\n`;
    });
    summary += '\n';
  }

  // à¸à¸´à¸ˆà¸à¸£à¸£à¸¡à¸—à¸µà¹ˆà¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¹€à¸£à¸´à¹ˆà¸¡
  if (pending.length > 0) {
    summary += 'à¸£à¸²à¸¢à¸à¸²à¸£à¸—à¸µà¹ˆà¸§à¸²à¸‡à¹à¸œà¸™à¹„à¸§à¹‰:\n';
    pending.forEach((act) => {
      const timeStr = act.time ? act.time.slice(0, 5) : 'à¸—à¸±à¹‰à¸‡à¸§à¸±à¸™';
      summary += `â€¢ ${act.title} (${timeStr})\n`;
    });
    summary += '\n';
  }

  // à¸à¸´à¸ˆà¸à¸£à¸£à¸¡à¸—à¸µà¹ˆà¸¢à¸à¹€à¸¥à¸´à¸/à¸‚à¹‰à¸²à¸¡
  if (cancelled.length > 0) {
    summary += 'à¸¢à¸à¹€à¸¥à¸´à¸/à¸‚à¹‰à¸²à¸¡:\n';
    cancelled.forEach((act) => {
      const timeStr = act.time ? act.time.slice(0, 5) : 'à¸—à¸±à¹‰à¸‡à¸§à¸±à¸™';
      summary += `â€¢ ${act.title} (${timeStr})\n`;
    });
    summary += '\n';
  }

  summary += 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n';
  summary += 'à¸„à¸§à¸²à¸¡à¸£à¸¹à¹‰à¸ªà¸¶à¸à¹à¸¥à¸°à¸„à¸§à¸²à¸¡à¸„à¸´à¸”à¹€à¸«à¹‡à¸™:\n';

  return summary;
}
